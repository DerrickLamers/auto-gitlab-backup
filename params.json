{"name":"Auto-gitlab-backup","tagline":"A simple script to backup Gitlab data. This script will backup the backup archives of your gitlab installation to a remote host, if configured.","body":"## AutoGITBackup\r\n\r\nhttp://sund.la/glup\r\n\r\n----\r\n\r\nA collection of scripts to use omnibus-gitlab's own backup ```gitlab-rake``` command on a cron schedule and rsync to another server, if wanted, or to restore a backup.\r\n\r\nAlso will backup and copy the Gitlab-CI DB if configured.\r\n\r\nThis script is now more omnibus-gitlab centric. Compare your config fiile with the template! Usage with a source install is possible but not expressly shown here.\r\n\r\n#### Clone\r\n\r\nclone to your directory of choice. I usually use ```/usr/local/sbin```\r\n\r\n#### Set up gitlab to expire backups\r\n\r\nChange ```/etc/gitlab/gitlab.rb``` to expire backups\r\n\r\n```\r\n# backup keep time\r\ngitlab_rails['backup_keep_time'] = 604800\r\n```\r\n\r\nIf you use the CI server, enable Ci Backup expiration\r\n\r\n```\r\n## Backup settings\r\n  backup:\r\n    path: \"tmp/backups\"   # Relative paths are relative to Rails.root (default: tmp/backups/)\r\n# limit CI backup lifetime to 7 days - 604800 seconds\r\ngitlab_ci['backup_keep_time'] = 604800\r\n```\r\n\r\n#### Configure the script for remote copy\r\n\r\n```bash\r\ncp auto-gitlab-backup.conf.sample auto-gitlab-backup.conf\r\n```\r\n\r\nedit ```auto-gitlab-backup.conf```\r\n\r\n```bash\r\nremoteUser=\"\" #user account on remote server\r\nremoteServer=\"\" #remote host\r\nremoteDest=\"\" #remote path\r\nsshKeyPath=\"\" #path to an alternate ssh key, if needed.\r\nremotePort=22 # ssh port\r\n## Only change the below setting if you have git's home in a different location or are installing gitlab from source\r\ngitHome=\"/var/opt/gitlab\"\r\n## only set below if rvm is in use and you need to source the rvm env file\r\n# echo $(rvm env --path)\r\nRVM_envPath=\"\"\r\n## only use the below settings if your destination is using rsync in daemon mode\r\nremoteModule=\"\"\r\nrsync_password_file=\"\"\r\ncheckQuota=\"0\" #change to true or 1 to enable\r\nenableCIBackup=\"0\" #change to true or 1 to enable CI backups\r\n```\r\n\r\n#### cron settings\r\n\r\nExample for crontab to run at 5:05am everyday.\r\n\r\n```bash\r\n5 5 * * * /usr/local/sbin/auto-gitlab-backup/auto-gitlab-backup.sh\r\n```\r\n\r\n## restore a backup\r\n\r\n*Still under development but useful*\r\n\r\nrun ```./restoreGitLab.sh -r``` and it will attempt to restore a backup. You may have to run some rake commands manually.\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}